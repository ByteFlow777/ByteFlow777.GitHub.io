<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://ileonli.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://ileonli.github.io/posts/c/inline-asm/><title>如何在 C 语言中使用内联汇编（翻译）</title></head><body><header id=banner></header><main id=content><article><header id=post-header><h1>如何在 C 语言中使用内联汇编（翻译）</h1><div><time>2023-08-29</time></div></header><blockquote><p><a href=https://gcc.gnu.org/onlinedocs/gcc/extensions-to-the-c-language-family/how-to-use-inline-assembly-language-in-c-code.html>https://gcc.gnu.org/onlinedocs/gcc/extensions-to-the-c-language-family/how-to-use-inline-assembly-language-in-c-code.html</a></p></blockquote><p><code>asm</code> 关键字允许你在 C 代码中嵌入汇编指令。GCC 提供了两种形式的内联 <code>asm</code> 语句。最基本的 <code>asm</code> 语句是没有操作数的，扩展的 <code>asm</code> 语句包含一个或多个操作数。若在函数中混合 C 代码和汇编代码，优先采用扩展形式；如果在顶层包含汇编语言，你必须使用 <code>asm</code>。</p><p>你也可以使用 <code>asm</code> 关键字来覆盖 C 符号（C symbol）的汇编名称，或将 C 变量放在特定寄存器中。</p><h2 id=基本汇编---不包含操作数的汇编指令>基本汇编 - 不包含操作数的汇编指令</h2><p>最基本的 <code>asm</code> 语句语法形式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>asm</span> <span class=no>asm-qualifiers</span> <span class=p>(</span> <span class=no>AssemblerInstructions</span> <span class=p>)</span>
</span></span></code></pre></div><p>对于 C 语言来说，<code>asm</code> 关键字是 GNU 扩展。在编写可使用 <a href=https://gcc.gnu.org/onlinedocs/gcc/gcc-command-options/options-controlling-c-dialect.html#cmdoption-ansi>-ansi</a> 和 <a href=https://gcc.gnu.org/onlinedocs/gcc/gcc-command-options/options-controlling-c-dialect.html#cmdoption-std>-std</a> 选项编译的 C 代码时，这些选项选择了不带 GNU 扩展的 C 语言方言，请使用 <code>__asm__</code> 代替 <code>asm</code>（<a href=https://gcc.gnu.org/onlinedocs/gcc/extensions-to-the-c-language-family/alternate-keywords.html#alternate-keywords>Alternate Keywords</a>）。对于 C++ 语言来说，<code>asm</code> 是关键字，但 <code>__asm__</code> 可以使用参数 <a href=https://gcc.gnu.org/onlinedocs/gcc/gcc-command-options/options-controlling-c-dialect.html#cmdoption-fno-asm>-fno-asm</a>。</p><h2 id=修饰符qualifiers>修饰符（Qualifiers）</h2><p><code>volatile</code>：可选的 <code>volatile</code> 没有任何影响（no effect），所有基本的 <code>asm</code> 块都隐含使用 <code>volatile</code> 修饰。</p><p><code>inline</code>：如果你使用 <code>inline</code> 修饰符，出于内联目的，<code>asm</code> 语句的大小被视为可能的最小。</p><h2 id=参数parameters>参数（Parameters）</h2><p><code>AssemblerInstructions</code>：用于指定汇编代码的文字字符串，该字符串可以包含汇编器识别的任何指令。GCC 本身不会解析汇编指令，也不知道它们的含义，甚至不知道它们是否是有效的汇编输入。</p></article></main><footer id=footer></footer></body></html>