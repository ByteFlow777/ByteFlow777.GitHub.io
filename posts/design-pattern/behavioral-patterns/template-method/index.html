<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://ileonli.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://ileonli.github.io/posts/design-pattern/behavioral-patterns/template-method/><title>行为模式 - 模板方法</title></head><body><header id=banner></header><main id=content><article><header id=post-header><h1>行为模式 - 模板方法</h1><div><time>2023-07-21</time></div></header><p>对于某一项任务，常常有<strong>稳定</strong>的整体操作结构，但各个子步骤却有很多<strong>改变</strong>的需求，或因为固有的原因（比如框架和应用之间的关系）导致整体结构和子步骤无法同时实现。</p><p>我们可以定义操作中的算法的基本骨架（稳定），将一些步骤（变化）推迟到子类实现。</p><p>模板方法使得子类可以复用一个算法结构，并改变某些特定步骤。</p><h2 id=jdk-中的应用>JDK 中的应用</h2><p>代码节选自 <code>java.io.InputStream</code> 类，该类有三个重载的 <code>read</code> 方法，分别是：</p><ol><li><code>read()</code> ：从输入流中读取一个字节，该方法为抽象方法，子类必须实现。</li><li><code>read(byte b[])</code> ：从输入流中读取 <code>b.length</code> 个字节，存储到 <code>b</code> 中。</li><li><code>read(byte b[], int off, int len)</code> ：从 <code>off</code> 位置开始读取 <code>len</code> 个字节，存储到 <code>b</code> 中。</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>InputStream</span> <span class=kd>implements</span> <span class=n>Closeable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>int</span> <span class=nf>read</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>read</span><span class=o>(</span><span class=kt>byte</span> <span class=n>b</span><span class=o>[])</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>read</span><span class=o>(</span><span class=n>b</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=n>b</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>read</span><span class=o>(</span><span class=kt>byte</span> <span class=n>b</span><span class=o>[],</span> <span class=kt>int</span> <span class=n>off</span><span class=o>,</span> <span class=kt>int</span> <span class=n>len</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>checkFromIndexSize</span><span class=o>(</span><span class=n>off</span><span class=o>,</span> <span class=n>len</span><span class=o>,</span> <span class=n>b</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>len</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=n>read</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>c</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=o>[</span><span class=n>off</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>byte</span><span class=o>)</span><span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span> <span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>c</span> <span class=o>=</span> <span class=n>read</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>c</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=n>b</span><span class=o>[</span><span class=n>off</span> <span class=o>+</span> <span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>byte</span><span class=o>)</span><span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>ee</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>read(byte b[], int off, int len)</code> 方法会调用无参的 <code>read()</code> 方法，不同类型的 <code>InputStream</code> 读取一个字节的流程也有所不同，但读取多个字节保存到字节数组中的操作是一致的。</p><p>因此，在 <code>InputStream</code> 类中无法定义 <code>read()</code> 方法的具体代码逻辑，将方法设为抽象方法，推迟到子类中实现。将 <code>read(byte b[], int off, int len)</code> 方法设置为模板方法，该方法定义了算法的基本骨架，便于子类复用此逻辑。</p></article></main><footer id=footer></footer></body></html>