<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://ileonli.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://ileonli.github.io/posts/design-pattern/behavioral-patterns/decorator/><title>行为模式 - 装饰器模式</title></head><body><header id=banner></header><main id=content><article><header id=post-header><h1>行为模式 - 装饰器模式</h1><div><time>2023-07-23</time></div></header><p>装饰器模式允许你通过将对象放入包含行为的特殊封装对象中，来为原对象增加新的行为。</p><p>装饰器模式可以类比如穿衣，当天气比较冷的时候可以穿上毛衣，当天气下雨的时候可以穿上雨衣。</p><h2 id=jdk-中的应用>JDK 中的应用</h2><p><code>java.io.BufferedInputStream</code> 为 <code>java.io.InputStream</code> 子类提供了缓存（buffer）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>InputStream</span> <span class=kd>implements</span> <span class=n>Closeable</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BufferedInputStream</span> <span class=kd>extends</span> <span class=n>FilterInputStream</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>BufferedInputStream</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>in</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>(</span><span class=n>in</span><span class=o>,</span> <span class=n>DEFAULT_BUFFER_SIZE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>BufferedInputStream</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>in</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>size</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Buffer size &lt;= 0&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>buf</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=n>size</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>用户只需要传入 <code>InputStream</code> 的子类，即可为传入的输入流提供缓存。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=n>var</span> <span class=n>stream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=s>&#34;file.txt&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>stream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[]{</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=o>);</span>
</span></span></code></pre></div><p>当需要使用缓存时，使用 <code>BufferedInputStream</code> 装饰 <code>InputStream</code> 即可。</p><p>如果不需要装饰，直接使用 <code>InputStream</code> 类，两者互不影响。</p><h2 id=mybatis>MyBatis</h2><p>org/apache/ibatis/cache/decorators</p></article></main><footer id=footer></footer></body></html>