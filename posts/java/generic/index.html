<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://ileonli.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://ileonli.github.io/posts/java/generic/><title>Java 泛型</title></head><body><header id=banner></header><main id=content><article><header id=post-header><h1>Java 泛型</h1><div><time>2023-02-08</time></div></header><p>泛型本质即把内部数据类型参数化，可以减少额外代码的编写。</p><p>尖括号之间的叫做类型参数（type parameter），通常采用单字母，大写的方式。</p><p>类型参数常用的字母包括：E（集合框架内元素）、K（key）、V（value）、N（number）、T（type）、</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Pair</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=n>k</span><span class=o>;</span> <span class=n>V</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Pair</span><span class=o>(</span><span class=n>K</span> <span class=n>k</span><span class=o>,</span> <span class=n>V</span> <span class=n>v</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>k</span> <span class=o>=</span> <span class=n>k</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>v</span> <span class=o>=</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=泛型方法>泛型方法</h2><p>泛型方法拥有独立泛型参数，可以有非静态和静态两种方式。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Util</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// non-static method
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kt>boolean</span> <span class=nf>compare</span><span class=o>(</span><span class=n>Pair</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>p1</span><span class=o>,</span> <span class=n>Pair</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>p2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>p1</span><span class=o>.</span><span class=na>k</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>p2</span><span class=o>.</span><span class=na>k</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=n>p1</span><span class=o>.</span><span class=na>v</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>p2</span><span class=o>.</span><span class=na>v</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Util</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// static method
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kt>boolean</span> <span class=nf>compare</span><span class=o>(</span><span class=n>Pair</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>p1</span><span class=o>,</span> <span class=n>Pair</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>p2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>p1</span><span class=o>.</span><span class=na>k</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>p2</span><span class=o>.</span><span class=na>k</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=n>p1</span><span class=o>.</span><span class=na>v</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>p2</span><span class=o>.</span><span class=na>v</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=n>Util</span><span class=o>.&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span><span class=n>compare</span><span class=o>(</span><span class=k>new</span> <span class=n>Pair</span><span class=o>&lt;&gt;(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>),</span> <span class=k>new</span> <span class=n>Pair</span><span class=o>&lt;&gt;(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Util</span><span class=o>.</span><span class=na>compare</span><span class=o>(</span><span class=k>new</span> <span class=n>Pair</span><span class=o>&lt;&gt;(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>),</span> <span class=k>new</span> <span class=n>Pair</span><span class=o>&lt;&gt;(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>));</span>
</span></span></code></pre></div><h2 id=参数限定>参数限定</h2><p>使用 <code>extends</code> 限定传入的泛型参数必须“继承”或“实现”自指定的“类”或“接口”。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Box</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Comparable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>t</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>可以采用 <code>&lt;T extends A & B & C></code> 的方法指定多个类型参数限定。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Box</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Number</span> <span class=o>&amp;</span> <span class=n>Comparable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span> <span class=n>Cloneable</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>t</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>类型参数限定支持多接口，由于 Java 只支持单继承，因此，只能有一个类限定，且必须放在首位。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// Error: Interface expected here
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Box</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Comparable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span> <span class=n>Cloneable</span> <span class=o>&amp;</span> <span class=n>Number</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>t</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=通配符>通配符</h2><p>通配符（?）可以用来表示未知类型。</p><p><code>extends</code> 允许传入类型为 <code>Number</code> 或 <code>Number</code> 子类的 <code>List</code> 类型。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>double</span> <span class=nf>sumOfList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Number</span><span class=o>&gt;</span> <span class=n>list</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>sum</span> <span class=o>=</span> <span class=mf>0.0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=o>(</span><span class=n>Number</span> <span class=n>number</span> <span class=o>:</span> <span class=n>list</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>+=</span> <span class=n>number</span><span class=o>.</span><span class=na>doubleValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sum</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>supper</code> 运算符允许传入类型为 <code>Integer</code> 或 <code>Integer</code> 父类的 <code>List</code> 类型。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>addNumbers</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>list</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>list</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=类型擦除>类型擦除</h2><p><code>Number</code> 是 <code>Integer</code> 的父类，但 <code>ArrayList&lt;Number></code> 不是 <code>ArrayList&lt;Integer></code> 的父类，而是同一种类型。</p><p><code>List&lt;Number></code> 是 <code>ArrayList&lt;Number></code> 的父类，而不是 <code>ArrayList&lt;Integer></code> 的父类。</p><blockquote><p><a href=https://docs.oracle.com/javase/tutorial/java/generics/types.html>https://docs.oracle.com/javase/tutorial/java/generics/types.html</a></p><p><a href=https://openjdk.org/projects/valhalla/>https://openjdk.org/projects/valhalla/</a></p><p><a href=https://openjdk.org/jeps/218>https://openjdk.org/jeps/218</a></p></blockquote></article></main><footer id=footer></footer></body></html>